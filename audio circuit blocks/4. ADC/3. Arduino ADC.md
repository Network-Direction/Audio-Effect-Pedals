# Arduino ADC

The arduino can be very useful in effects pedals (and electronics in general), as it can take an analogue signal, and tell you something about it, or apply some effect digitally.

Of course, the key part of this we need is its ADC, as it will only work with digital signals.

> [!IMPORTANT]
> This article assumes the ATMEGA328 architecture (eg, Uno, Nano, etc). Implementation details will vary on other models.


</br></br>
## Ardunio ADC

The Arduino Uno has six onboard ADC channels. These are the analogue inputs A0 - A5.

These channels expect an input between 0v and +5v. This can be changed using the **analogReference()** function, but the options here are limited.

Each channel has a 10-bit resolution, meaning that input voltages are represented as values from 0 to 1023 (where 0v is 0, and 5v is 1023). The **analogRead()** function reads the voltage on the analog pin, and returns a value from 0 - 1023.


</br></br>
## Interrupts

Normally, Arduino code runs within the main **loop()**. For many things this is fine, but for audio applications it causes a problem. The code within the loop affects how long each loop takes to run. This makes it difficult to perform tasks on very regular intervals. We need regular intervals, for example, when sampling an input signal.

Fortunately, the arduino, like many microcontrollers and computers, contain _interrupts_. To oversimplify a bit, a interrupt is a signal sent to the microcontroller to tell it to run a specific block of code, regardless of where it's up to in the main loop.

Effectively, it _interrupts_ the loop execution to run some critical code, and then allows the loop to continue where it left off.

Broadly speaking, we might use interrupts in two possible ways:
* To handle a critical event as soon as it happens
* To run some code on a regular interval

As you can see, for audio signals, interrupts are critical for sampling.


</br></br>
## Timers

The Ardunino has three timers, named timer0, timer1, and timer2. These timers contain a counter, which is just a number that the microcontroller keeps track of.

The Ardunio also has an internal clock, which operates at 16MHz. That means the clock _ticks_ 6-million times every second. Every time the clock ticks, each of the value in each of these timers are incremented by 1. This means these timers count up very very quickly.

Timer0 and 2 are 8-bit timers, meaning they can count from 0 to 255. Timer1 is 16-bit, counting from 0 to 65535. When the timer is 'full', the next tick resets the clock, and it starts back at zero.

As the clocks tick 16 million times every second, these timers fill and reset multiple times a second. This is often not too useful. Fortunately, we can configure how we use them.


</br></br>
## Prescalers

A **prescaler** configures how fast the timers increment. They don't change the clock speed, that's fixed at 16MHz. What they change is how many clock ticks are required to increment the value in the timer.

The prescaler is just an integer, a whole number. By default it's set to 1, which means the counters increment with every clock tick. If the prescaler were set to 2, the counters would increment by one every second clock tick. We can express this as a formula:

```math
Timer = {Clock Speed \over Prescaler}
```

</br></br>
Here, 'Timer' is the timer speed in Hz. This tells us that the higher the prescaler value, the slower the timers will increment.


