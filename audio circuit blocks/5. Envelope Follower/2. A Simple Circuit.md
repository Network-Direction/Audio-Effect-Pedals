# A Simple Envelope Follower

The purpose of an envelope follower is to create an output voltage that represents the shape of an input signal.

We can start by breaking this down into the simplest components:
1. High Pass Filter
2. Rectifier

This very simple circuit will look something like this:

![image](https://github.com/user-attachments/assets/c30f5719-68dd-4d30-af16-d1f4af3d9985)


Let's break down how this works


</br></br>
## High Pass Filter

The first component is the high pass filter. The most important job this plays is to remove DC offset.

It's possible this has already been done by some external circuitry before the signal reaches the filter, so technically you don't _need_ to have this, but it's still a good idea.

The HPF also removes any very low frequencies that will act similar to DC voltage.

So what rolloff frequency should we use? As a rough idea, somwhere 15KHz or lower is good. It might depend on what you're trying to do. If you really want to track lower frequencies for some reason, you may need to adjust.

</br></br>
We also need to think about how **responsive** the filter is. Remember that capacitors have a [time constant](https://github.com/Network-Direction/Audio-Effect-Pedals/blob/Wha-Pedals/audio%20circuit%20blocks/3.%20Filters/4.%20Phase%20Shift.md). That is, it takes time for a capacitor to charge and discharge.

The _speed_ of the envelope follower, that is, how fast it _responds_ to changes in the input signal will depend on this time constant.

If we use a large resistor or capacitor in the filter, we will have a large time constant, meaning that the circuit will not respond to changes as quickly. Using smaller resistors and capacitors result in a lower time constant, which makes the circuit respond faster.

We have some say in the resistors and capacitors we use in the filter. But it's clear that smaller components will yield a smaller time constant, which improves responsiveness. We might find that different cutoff frequencies are better than others depending on our case.

Synths for example, may benefit from a very small time constant, which would mean a filter with a rolloff at around 5Hz. Guitars may be better at about 10Hz, while specific music genere's may require something else.

The simple circuit above uses a 10Hz rolloff, which seems to be a fairly nice balanced value.


</br></br>
## Rectifier

This simple circuit contains a _half-wave rectifier_. This is the single diode.

The audio signal is represented as AC, which moves in both directions. The diode allows the signal to move in one direction, but not the other.

The result is that the positive half of the signal's wave is kept, while the negative half is discarded. This is a critical step in creating a DC voltage output, which does not fluctuate between positive and negative like AC does.


</br></br>
Why a half-wave rectifier and not a full-wave rectifier?

Unlike a half-wave rectifier, a full wave rectifier keeps the negative portion of a wave, but inverts it so it's all positive.

![image](https://github.com/user-attachments/assets/22ba9414-a1e6-4159-a8c5-4213bbed1468)

In this simple circuit, a half-wave rectifier is used as it's simple. One single diode.

A full-wave rectifier can definitely be used, and it has the advantage of being more _accurate_ in a sense, as it doesn't lose any information.


</br></br>
## Testing

As a quick test, I can attach a sine wave generator as the input, and an osciloscope on the output.

The sine wave generator is creating a 2KHz signal, with a strength of 2.5v peak to peak.

For this to work, I have connected a 1M resistor between the output of the diode and ground. This is to simulate a load on the circuit. Without this, the circuit really has no idea what ground is.

The result is this:

![half-wave](https://github.com/user-attachments/assets/5290dd5f-f5d3-49e0-9171-1bf4f218af6c)

</br></br>
There are two important things to note here:
1. The output is effectively just a rectified signal. It's not much of an envelope follower yet
2. The signal is now 946mV peak to peak. We've lost a lot of signal strength

</br></br>
Why the loss of signal strength? There are two reasons.

Firstly, when the signal passes through the diode, we have to consider the forward voltage drop of the diode. It's about 0.6v for this diode, so we're down to 1.9v

Secondly, when we rectify the signal, we lose about half of the signal strength. That brings us to the 0.95v that we're seeing here.


</br></br>
So there are clearly some improvements to be made:
1. We need a smoothed output, so it's not just a rectified signal
2. We need to restore some of the lost power in the signal


</br></br>
---
# Signal Smoothing
## Smoothing an AC Signal

Signal smoothing is nice and easy. We just need to add a capacitor to the circuit.

If you're familiar with power supplies, you'll be comfortable here. An AC to DC power supply will have a bridge rectifier, followed by smoothing components, which converts the AC power to nice clean DC power.

The capacitor sits neatly at the end of the circuit, right before the load.

![image](https://github.com/user-attachments/assets/281b595a-fb48-4911-8589-2165a7af5b72)

When we input our sine wave to this circuit, we now get a steady DC signal as an output:

![Smoothed signal](https://github.com/user-attachments/assets/bc970e11-5600-456f-bed8-a779d1d2ffb0)

Granted, the input is a simple sine wave, so we won't see anything particularly exciting here. The peak voltage is still lower than hoped, clocking in at about 0.7v. We'll deal with that soon.


</br></br>
## Smoothing Capacitor

So why use a 4.7uF capacitor? This is a nice balanced value that's suitable in many cases. We can change it depending on what we want.

A smaller capacitor (1uF for example) will make the output more responsive. This is the same principle as was the case with the high pass filter. The catch is, the output may be more 'choppy', with the output voltage being jagged, or fluctiating rapidly. This can still be a good choice for percussive instruments, which would also include slap bass and funk.

A larger capacitor (say, 10uF) will respond slower, but result in a smoother output voltage. This is useful when there's a lot of sustain, or in effects such as compression. If this is too high, the response may seem sluggish, or it may be smoothed out entirely.


</br></br>
---
# Amplification

